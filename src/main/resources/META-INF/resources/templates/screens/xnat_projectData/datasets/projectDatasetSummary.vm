<!-- projectDatasetSummary.vm -->
<div id="summary-no-datasets" class="hidden">
    <p class="panel-element">In order to create a dataset for training, you must define your dataset criteria. No criteria have been defined in this project yet. </p>
</div>
<div id="summary-datasets-found">
    <div class="panel-element" data-name="">
        <div class="element-label">Dataset Definitions</div>
        <div class="element-wrapper">
            <span id="ml-tab-definition-count">0</span>
        </div>
        <br class="clear">
    </div>
    <div class="panel-element" data-name="">
        <div class="element-label">Saved Datasets</div>
        <div class="element-wrapper">
            <span id="ml-tab-datasets-count">0</span>
        </div>
        <br class="clear">
    </div>
</div>
<p>
    <a href="$content.getURI("/app/template/Page.vm?view=datasets/dashboard&project=$!{project.getId()}")">
        <button class="btn">Manage Datasets</button>
    </a>
</p>

<script>
    console.log('collections-initProject.js');

    (function(factory){
        if (typeof define === 'function' && define.amd) {
            define(factory);
        }
        else if (typeof exports === 'object') {
            module.exports = factory();
        }
        else {
            return factory();
        }
    }(function() {

        var undef, itemsFound=false;

        var XNAT = getObject(window.XNAT || {});
        XNAT.plugin = getObject(XNAT.plugin || {});
        XNAT.plugin.collection = getObject(XNAT.plugin.collection || {});

        var rootUrl = XNAT.url.rootUrl;

        function showCount(data,type){
            var results = data.ResultSet && data.ResultSet.Result
                    ? data.ResultSet.Result
                    : data;
            if (results.length) {
                $('#ml-tab-'+type+'-count').html(results.length);
                itemsFound = true;
            }
        }

        function getItems(url, name) {
            XNAT.xhr.get({
                url: rootUrl(url),
                async: false,
                success: function(data) {
                    showCount(data, name);
                },
                fail: function(e) {
                    console.error(e);
                }
            });
        }

        XNAT.plugin.collection.projectInit = function(projectId) {
            getItems('/xapi/sets/definitions/projects/' + projectId, "definitions");
            getItems('/xapi/sets/datasets/projects/' + projectId, "datasets");
        };

        $(function() {
            XNAT.plugin.collection.projectInit(XNAT.data.context.projectID);
        });

    }));
</script>